{% load static %}

<nav class="bg-white border-b border-gray-200 hidden lg:block relative z-40"
     x-data="{
        activeTab: {{ main_menu_categories.first.id|default:'null' }},
        menuOpen: false
     }">

    <div class="container mx-auto px-4">
        <ul class="flex items-center gap-1">

            <li class="relative group py-3 px-2"
                @mouseenter="menuOpen = true"
                @mouseleave="menuOpen = false">

                <a href="#" class="font-bold text-gray-800 flex items-center gap-2 text-sm hover:text-red-600 cursor-pointer border-b-2 border-transparent hover:border-red-600 pb-3 mt-3 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    دسته‌بندی کالاها
                </a>

                <div x-show="menuOpen"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 translate-y-2"
                     class="absolute top-full right-0 w-[90vw] max-w-[1200px] bg-white shadow-2xl rounded-bl-2xl rounded-br-2xl border-t border-gray-100 z-50 flex overflow-hidden min-h-[450px]"
                     style="display: none;"> <div class="w-1/5 bg-gray-50 overflow-y-auto border-l border-gray-100 py-2">
                        <ul>
                            {% for category in main_menu_categories %}
                            <li @mouseover="activeTab = {{ category.id }}"
                                :class="activeTab === {{ category.id }} ? 'bg-white text-red-600 border-r-4 border-red-600' : 'text-gray-600 hover:bg-gray-100'"
                                class="cursor-pointer transition-all duration-200">

                                <a href="{% url 'products:product_list' %}?category={{ category.slug }}" class="flex items-center gap-3 py-3 px-4 text-sm font-bold w-full h-full">
                                    {% if category.icon %}
                                        <img src="{{ category.icon.url }}" class="w-5 h-5 object-contain opacity-80">
                                    {% else %}
                                        <svg class="w-5 h-5 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                                    {% endif %}
                                    {{ category.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="flex-1 p-6 bg-white relative">
                        {% for category in main_menu_categories %}
                        <div x-show="activeTab === {{ category.id }}" class="flex h-full animate-fade-in">

                            <div class="flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-8 content-start overflow-y-auto pr-2 max-h-[450px]">

                                <a href="{% url 'products:product_list' %}?category={{ category.slug }}" class="col-span-full flex items-center gap-2 text-sm font-bold text-gray-800 hover:text-red-600 mb-2">
                                    همه محصولات {{ category.name }}
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                </a>

                                {% if category.menu_columns.all %}
                                    {% for column in category.menu_columns.all %}
                                    <div>
                                        <h4 class="font-bold text-gray-800 mb-3 text-sm border-r-2 border-red-500 pr-2 pl-2">
                                            {{ column.title }}
                                        </h4>
                                        <ul class="space-y-2">
                                            {% for item in column.items.all %}
                                            <li>
                                                <a href="{{ item.url }}" class="text-xs text-gray-500 hover:text-red-600 hover:font-bold transition flex items-center gap-2">
                                                    {{ item.title }}
                                                </a>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endfor %}
                                {% endif %}

                                {% if category.children.all %}
                                <div class="col-span-full mt-4 border-t border-gray-100 pt-4">
                                    <h4 class="font-bold text-gray-800 mb-3 text-sm">دسته‌بندی‌ها</h4>
                                    <div class="flex flex-wrap gap-3">
                                        {% for child in category.children.all %}
                                        <a href="{% url 'products:product_list' %}?category={{ child.slug }}" class="bg-gray-50 hover:bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-xs transition border border-gray-100">
                                            {{ child.name }}
                                        </a>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                            </div>

                            {% if category.image %}
                            <div class="w-64 pl-4 hidden xl:block flex-shrink-0">
                                <a href="{% url 'products:product_list' %}?category={{ category.slug }}" class="block h-full relative rounded-2xl overflow-hidden group/ad">
                                    <img src="{{ category.image.url }}" class="w-full h-full object-cover transform group-hover/ad:scale-105 transition duration-700">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent flex items-end p-6">
                                        <span class="text-white font-bold text-lg drop-shadow-md">{{ category.name }}</span>
                                    </div>
                                </a>
                            </div>
                            {% endif %}

                        </div>
                        {% endfor %}
                    </div>

                </div>
            </li>

            <li class="hidden md:flex items-center gap-1 text-sm font-bold text-gray-600 hover:text-red-600 transition ml-4 border-l pl-4 border-gray-300">
                <a href="#" class="hover:text-red-600 transition flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    سوالی دارید؟
                </a>
            </li>

            <div class="flex gap-3 items-center">

        {% if user.is_authenticated and user.vendor_profile %}
            <a href="{% url 'vendor_panel:dashboard' %}" class="hidden md:flex items-center gap-1 text-sm font-bold text-gray-600 hover:text-red-600 transition ml-4">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                پنل فروشندگان
            </a>
        {% else %}
            <a href="{% url 'vendor_panel:seller_landing' %}" class="hidden md:flex items-center gap-1 text-sm font-bold text-gray-600 hover:text-red-600 transition ml-4 border-l pl-4 border-gray-300">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                در دیجی‌شاپ بفروشید!
            </a>
        {% endif %}

        </div>

        </ul>
    </div>
</nav>